pipeline {
    agent any
    
    environment {
        // Define environment variables for your Render cloud PostgreSQL database
        RENDER_DATABASE_HOSTNAME = 'dpg-cp2jb6fsc6pc73a6qem0-a.oregon-postgres.render.com'
        RENDER_DATABASE_PORT = 5432
        RENDER_DATABASE_NAME = 'eventdatabase_gq69'
        RENDER_DATABASE_USERNAME = 'eventdatabase_gq69_user'
        RENDER_DATABASE_PASSWORD = 'oiKQmXkS4srpTlTK8TZgtqJkM0bo8X2P'
        EXTERNAL_DATABASE_URL = "postgres://${RENDER_DATABASE_USERNAME}:${RENDER_DATABASE_PASSWORD}@${RENDER_DATABASE_HOSTNAME}:${RENDER_DATABASE_PORT}/${RENDER_DATABASE_NAME}"
        PSQL_COMMAND = "PGPASSWORD=${RENDER_DATABASE_PASSWORD} psql -h ${RENDER_DATABASE_HOSTNAME} -U ${RENDER_DATABASE_USERNAME} ${RENDER_DATABASE_NAME}"
    }
    
    stages {
        stage('Deploy Database to Render') {
            steps {
                script {
                    // Deploy your PostgreSQL database on Render
                    bat "render up database --database-url ${EXTERNAL_DATABASE_URL}"
                }
            }
        }
        
        stage('Run Tests') {
            steps {
                script {
                    // Run your database tests (replace 'your-test-command' with actual test command)
                    bat 'your-test-command'
                }
            }
        }
    }
    
    post {
        always {
            // Logout from Render (if needed)
            script {
                bat 'render logout'
            }
        }
    }
}
