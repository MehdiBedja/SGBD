pipeline {
    agent any
    
    environment {
        // Define environment variables for your local database details
        DATABASE_HOSTNAME = 'localhost'  // Assuming the database is running locally
        DATABASE_PORT = 5433
        DATABASE_NAME = 'eventlocaledatabase'
        DATABASE_USERNAME = 'postgres'
        DATABASE_PASSWORD = 'root'
        INTERNAL_DATABASE_URL = "postgres://${DATABASE_USERNAME}:${DATABASE_PASSWORD}@${DATABASE_HOSTNAME}:${DATABASE_PORT}/${DATABASE_NAME}"
        
        // Define environment variables for the Render cloud PostgreSQL database
        RENDER_DATABASE_HOSTNAME = 'dpg-cp2jb6fsc6pc73a6qem0-a.oregon-postgres.render.com'
        RENDER_DATABASE_PORT = 5432
        RENDER_DATABASE_NAME = 'eventdatabase_gq69'
        RENDER_DATABASE_USERNAME = 'eventdatabase_gq69_user'
        RENDER_DATABASE_PASSWORD = 'oiKQmXkS4srpTlTK8TZgtqJkM0bo8X2P'
        EXTERNAL_DATABASE_URL = "postgres://eventdatabase_gq69_user:oiKQmXkS4srpTlTK8TZgtqJkM0bo8X2P@dpg-cp2jb6fsc6pc73a6qem0-a.oregon-postgres.render.com/eventdatabase_gq69"
        PSQL_COMMAND = "PGPASSWORD=${RENDER_DATABASE_PASSWORD} psql -h ${RENDER_DATABASE_HOSTNAME} -U ${RENDER_DATABASE_USERNAME} ${RENDER_DATABASE_NAME}"
    }
    
    stages {
        stage('Deploy Database to Render') {
            steps {
                script {
                    // Deploy your PostgreSQL database on Render
                    bat "render up database --database-url ${EXTERNAL_DATABASE_URL}"
                }
            }
        }
        
        stage('Run Tests') {
            steps {
                script {
                    // Run your database tests
                    bat 'your-test-command'
                }
            }
        }
    }
    
    post {
        always {
            // Logout from Render (if needed)



            // script {
            //     bat 'render logout'
            // }
        }
    }
}
