pipeline {
    agent any
    
    environment {
        // Define environment variables for database details
        DATABASE_HOSTNAME = 'dpg-cp2jb6fsc6pc73a6qem0-a'
        DATABASE_PORT = 5432
        DATABASE_NAME = 'eventdatabase_gq69'
        DATABASE_USERNAME = 'eventdatabase_gq69_user'
        DATABASE_PASSWORD = 'oiKQmXkS4srpTlTK8TZgtqJkM0bo8X2P'
        INTERNAL_DATABASE_URL = "postgres://${DATABASE_USERNAME}:${DATABASE_PASSWORD}@${DATABASE_HOSTNAME}/${DATABASE_NAME}"
        EXTERNAL_DATABASE_URL = "postgres://${DATABASE_USERNAME}:${DATABASE_PASSWORD}@${DATABASE_HOSTNAME}.oregon-postgres.render.com/${DATABASE_NAME}"
        PSQL_COMMAND = "PGPASSWORD=${DATABASE_PASSWORD} psql -h ${DATABASE_HOSTNAME}.oregon-postgres.render.com -U ${DATABASE_USERNAME} ${DATABASE_NAME}"
    }
    
    stages {
        stage('Setup') {
            steps {
                script {
                    // Login to Render (if needed)
                    // bat "render login --email ${RENDER_EMAIL} --password ${RENDER_PASSWORD}"
                }
            }
        }
        
        stage('Deploy Database') {
            steps {
                script {
                    // Deploy your PostgreSQL database on Render
                    bat "render up database --database-url ${EXTERNAL_DATABASE_URL}"
                }
            }
        }
        
        stage('Run Tests') {
            steps {
                script {
                    // Run your database tests
                    bat 'your-test-command'
                }
            }
        }
    }
    
    post {
        always {
            // Logout from Render (if needed)
            // script {
            //     bat 'render logout'
            // }
        }
    }
}
